import { JsonLd } from '~/app/_components'

<JsonLd
  metadata={{
    title: 'BroadcastChannel API ì™„ë²½ ê°€ì´ë“œ',
    description: 'BroadcastChannel APIë¥¼ í™œìš©í•˜ì—¬ ê°™ì€ originì˜ ì—¬ëŸ¬ íƒ­/ì°½ ê°„ ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹ ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì™„ë²½í•˜ê²Œ ì„¤ëª…í•©ë‹ˆë‹¤. ë©€í‹°íƒ­ ë¡œê·¸ì¸ ë™ê¸°í™”, ì¥ë°”êµ¬ë‹ˆ ê³µìœ , í…Œë§ˆ ì„¤ì •, ì•Œë¦¼ ì‹œìŠ¤í…œ ë“± ì‹¤ì „ ì˜ˆì œì™€ í•¨ê»˜ API ë ˆí¼ëŸ°ìŠ¤, ì„±ëŠ¥ ìµœì í™”, ë³´ì•ˆ ê³ ë ¤ì‚¬í•­ì„ ë‹¤ë£¹ë‹ˆë‹¤.',
    date: '2025-01-04',
    slug: 'broadcast-channel-api',
    tags: ['Web API', 'JavaScript', 'Browser', 'Communication', 'BroadcastChannel', 'Multi-Tab', 'ì™„ë²½ ê°€ì´ë“œ'],
  }}
/>

# BroadcastChannel API ì™„ë²½ ê°€ì´ë“œ

## ğŸ“‹ ë¬¸ì„œ ì •ë³´
- **ë¬¸ì„œ ìœ í˜•**: Concept Explanation + API Reference
- **ëŒ€ìƒ ë…ì**: ì¤‘ê¸‰ ì›¹ ê°œë°œì
- **ì£¼ìš” ëª©í‘œ**: ê°™ì€ ì¶œì²˜ì˜ ì—¬ëŸ¬ íƒ­/ì°½ ê°„ ì‹¤ì‹œê°„ í†µì‹  êµ¬í˜„
- **ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2024-12-14

---

## ê°œìš”

BroadcastChannel APIëŠ” ê°™ì€ originì˜ ì—¬ëŸ¬ browsing contexts (íƒ­, ì°½, iframe, ì›¹ ì›Œì»¤ ë“±) ê°„ ì–‘ë°©í–¥ í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ì›¹ ë¸Œë¼ìš°ì € APIì…ë‹ˆë‹¤.

**ì´ ê°€ì´ë“œë¥¼ ì½ê³  ë‚˜ë©´ ë‹¤ìŒì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:**
- ì—¬ëŸ¬ íƒ­/ì°½ ê°„ ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™” êµ¬í˜„
- íƒ­ ê°„ ì‚¬ìš©ì ìƒíƒœ ê³µìœ  (ë¡œê·¸ì¸, í…Œë§ˆ ì„¤ì • ë“±)
- ë¸Œë¼ìš°ì € ì „ì—­ ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬ì¶•
- ë©€í‹°íƒ­ í™˜ê²½ì—ì„œ ì¼ê´€ëœ ì‚¬ìš©ì ê²½í—˜ ì œê³µ

---

## ì™œ BroadcastChannel APIê°€ í•„ìš”í•œê°€?

### í•´ê²°í•˜ë ¤ëŠ” ë¬¸ì œ

ì „í†µì ìœ¼ë¡œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ê° íƒ­ì´ ë…ë¦½ì ìœ¼ë¡œ ë™ì‘í–ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì—¬ëŸ¬ íƒ­ì—ì„œ ê°™ì€ ì›¹ ì•±ì„ ì—´ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:

1. **ë°ì´í„° ë¶ˆì¼ì¹˜**: í•œ íƒ­ì—ì„œ ë°ì´í„°ë¥¼ ìˆ˜ì •í•´ë„ ë‹¤ë¥¸ íƒ­ì— ë°˜ì˜ë˜ì§€ ì•ŠìŒ
2. **ì¤‘ë³µ ì‘ì—…**: ì—¬ëŸ¬ íƒ­ì—ì„œ ë™ì¼í•œ API ìš”ì²­ì„ ì¤‘ë³µ ì‹¤í–‰
3. **ì¸ì¦ ìƒíƒœ ë¶ˆì¼ì¹˜**: í•œ íƒ­ì—ì„œ ë¡œê·¸ì•„ì›ƒí•´ë„ ë‹¤ë¥¸ íƒ­ì€ ì—¬ì „íˆ ë¡œê·¸ì¸ ìƒíƒœ
4. **ë¹„íš¨ìœ¨ì ì¸ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©**: ê° íƒ­ì´ ë…ë¦½ì ìœ¼ë¡œ ì›¹ì†Œì¼“ ì—°ê²° ìœ ì§€

### ì´ì „ í•´ê²° ë°©ë²•ì˜ í•œê³„

BroadcastChannel ì´ì „ì—ëŠ” ë‹¤ìŒ ë°©ë²•ë“¤ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤:

```javascript
// âŒ êµ¬ì‹ ë°©ë²• 1: localStorage + storage ì´ë²¤íŠ¸
localStorage.setItem('message', JSON.stringify(data));
window.addEventListener('storage', (e) => {
  if (e.key === 'message') {
    const data = JSON.parse(e.newValue);
    // ë‹¤ë¥¸ íƒ­ì˜ ë³€ê²½ ì‚¬í•­ ì²˜ë¦¬
  }
});

// âŒ êµ¬ì‹ ë°©ë²• 2: SharedWorker
const worker = new SharedWorker('worker.js');
worker.port.onmessage = (e) => {
  console.log(e.data);
};
```

**ì´ì „ ë°©ë²•ì˜ ë¬¸ì œì :**
- localStorage: ë¬¸ìì—´ë§Œ ì €ì¥ ê°€ëŠ¥, ê°™ì€ íƒ­ì—ì„œëŠ” ì´ë²¤íŠ¸ ë°œìƒí•˜ì§€ ì•ŠìŒ
- SharedWorker: ë³µì¡í•œ ì„¤ì •, ì œí•œì ì¸ ë¸Œë¼ìš°ì € ì§€ì›
- Polling: ë¹„íš¨ìœ¨ì ì¸ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©

---

## í•µì‹¬ ê°œë…

### BroadcastChannelì˜ ì‘ë™ ì›ë¦¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Same Origin                           â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Tab 1   â”‚         â”‚  Tab 2   â”‚         â”‚  Tab 3   â”‚â”‚
â”‚  â”‚          â”‚         â”‚          â”‚         â”‚          â”‚â”‚
â”‚  â”‚ Channel  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Channel  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Channel  â”‚â”‚
â”‚  â”‚  "sync"  â”‚         â”‚  "sync"  â”‚         â”‚  "sync"  â”‚â”‚
â”‚  â”‚          â”‚         â”‚          â”‚         â”‚          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚                    â”‚                    â”‚      â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                            â”‚                           â”‚
â”‚                    postMessage(data)                   â”‚
â”‚                            â”‚                           â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚  Broadcast to â”‚                   â”‚
â”‚                    â”‚  All Channels â”‚                   â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì£¼ìš” íŠ¹ì§•

1. **ìë™ ë¸Œë¡œë“œìºìŠ¤íŒ…**: í•œ ì±„ë„ì—ì„œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ë©´ ê°™ì€ ì´ë¦„ì˜ ëª¨ë“  ì±„ë„ì´ ìˆ˜ì‹ 
2. **êµ¬ì¡°í™”ëœ ë°ì´í„° ì§€ì›**: ê°ì²´, ë°°ì—´ ë“± ë³µì¡í•œ ë°ì´í„° íƒ€ì… ì§ì ‘ ì „ì†¡ ê°€ëŠ¥
3. **ì–‘ë°©í–¥ í†µì‹ **: ëª¨ë“  ì±„ë„ì´ ì†¡ì‹ ìì´ì ìˆ˜ì‹ ì
4. **Same-Origin ì •ì±…**: ê°™ì€ origin(í”„ë¡œí† ì½œ + ë„ë©”ì¸ + í¬íŠ¸)ì—ì„œë§Œ ë™ì‘

---

## API ë ˆí¼ëŸ°ìŠ¤

### `BroadcastChannel()` ìƒì„±ì

ì±„ë„ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

#### ì‹œê·¸ë‹ˆì²˜

```typescript
const channel = new BroadcastChannel(channelName: string);
```

#### ë§¤ê°œë³€ìˆ˜

- **`channelName`** (í•„ìˆ˜)
  - **íƒ€ì…**: `string`
  - **ì„¤ëª…**: ì±„ë„ì„ ì‹ë³„í•˜ëŠ” ê³ ìœ í•œ ì´ë¦„. ê°™ì€ ì´ë¦„ì˜ ì±„ë„ë¼ë¦¬ë§Œ í†µì‹  ê°€ëŠ¥
  - **ì˜ˆì‹œ**: `'user-sync'`, `'notifications'`, `'theme-updates'`

#### ì˜ˆì œ

```javascript
// ì‚¬ìš©ì ë™ê¸°í™” ì±„ë„ ìƒì„±
const userChannel = new BroadcastChannel('user-sync');

// ì•Œë¦¼ ì±„ë„ ìƒì„±
const notificationChannel = new BroadcastChannel('notifications');
```

---

### `postMessage()` ë©”ì„œë“œ

ì±„ë„ë¡œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.

#### ì‹œê·¸ë‹ˆì²˜

```typescript
channel.postMessage(message: any): void;
```

#### ë§¤ê°œë³€ìˆ˜

- **`message`** (í•„ìˆ˜)
  - **íƒ€ì…**: `any` (êµ¬ì¡°í™”ëœ ë³µì œ ì•Œê³ ë¦¬ì¦˜ ì§€ì› íƒ€ì…)
  - **ì„¤ëª…**: ì „ì†¡í•  ë°ì´í„°. ê°ì²´, ë°°ì—´, ê¸°ë³¸ íƒ€ì… ëª¨ë‘ ê°€ëŠ¥
  - **ì œí•œ**: í•¨ìˆ˜, Symbol, DOM ë…¸ë“œëŠ” ì „ì†¡ ë¶ˆê°€

#### ì˜ˆì œ

```javascript
const channel = new BroadcastChannel('app-sync');

// ë¬¸ìì—´ ì „ì†¡
channel.postMessage('Hello from Tab 1');

// ê°ì²´ ì „ì†¡
channel.postMessage({
  type: 'USER_LOGIN',
  userId: '12345',
  username: 'john_doe',
  timestamp: Date.now()
});

// ë°°ì—´ ì „ì†¡
channel.postMessage(['item1', 'item2', 'item3']);
```

---

### `message` ì´ë²¤íŠ¸

ë‹¤ë¥¸ ì±„ë„ì—ì„œ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í–ˆì„ ë•Œ ë°œìƒí•©ë‹ˆë‹¤.

#### ì´ë²¤íŠ¸ ê°ì²´

```typescript
interface MessageEvent {
  data: any;           // ìˆ˜ì‹ í•œ ë©”ì‹œì§€ ë°ì´í„°
  origin: string;      // ë©”ì‹œì§€ ë°œì‹  origin
  lastEventId: string; // ì´ë²¤íŠ¸ ID (ì¼ë°˜ì ìœ¼ë¡œ ë¹ˆ ë¬¸ìì—´)
  source: null;        // BroadcastChannelì€ í•­ìƒ null
  ports: MessagePort[]; // ì „ì†¡ëœ í¬íŠ¸ (ì¼ë°˜ì ìœ¼ë¡œ ë¹ˆ ë°°ì—´)
}
```

#### ì˜ˆì œ

```javascript
const channel = new BroadcastChannel('app-sync');

channel.addEventListener('message', (event) => {
  console.log('ë°›ì€ ë©”ì‹œì§€:', event.data);

  // íƒ€ì…ë³„ ì²˜ë¦¬
  if (event.data.type === 'USER_LOGIN') {
    handleUserLogin(event.data);
  } else if (event.data.type === 'USER_LOGOUT') {
    handleUserLogout(event.data);
  }
});

// ë˜ëŠ” onmessage ì†ì„± ì‚¬ìš©
channel.onmessage = (event) => {
  console.log('ë°›ì€ ë©”ì‹œì§€:', event.data);
};
```

---

### `messageerror` ì´ë²¤íŠ¸

ë©”ì‹œì§€ ì—­ì§ë ¬í™”ì— ì‹¤íŒ¨í–ˆì„ ë•Œ ë°œìƒí•©ë‹ˆë‹¤.

#### ì˜ˆì œ

```javascript
const channel = new BroadcastChannel('app-sync');

channel.addEventListener('messageerror', (event) => {
  console.error('ë©”ì‹œì§€ ì²˜ë¦¬ ì˜¤ë¥˜:', event);
});
```

---

### `close()` ë©”ì„œë“œ

ì±„ë„ì„ ë‹«ê³  ë¦¬ì†ŒìŠ¤ë¥¼ í•´ì œí•©ë‹ˆë‹¤.

#### ì‹œê·¸ë‹ˆì²˜

```typescript
channel.close(): void;
```

#### ì˜ˆì œ

```javascript
const channel = new BroadcastChannel('app-sync');

// ì‘ì—… ì™„ë£Œ í›„ ì±„ë„ ë‹«ê¸°
channel.close();

// ë‹«íŒ ì±„ë„ì—ì„œ ë©”ì‹œì§€ ì „ì†¡ ì‹œë„í•˜ë©´ ì˜¤ë¥˜ ë°œìƒ
// channel.postMessage('test'); // âŒ DOMException
```

---

## ì‹¤ì „ ì‚¬ìš© ì˜ˆì œ

### ì˜ˆì œ 1: ë©€í‹°íƒ­ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë™ê¸°í™”

ëª¨ë“  íƒ­ì—ì„œ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ë™ê¸°í™”í•©ë‹ˆë‹¤.

```javascript
// auth-sync.js

class AuthSync {
  constructor() {
    this.channel = new BroadcastChannel('auth-sync');
    this.setupListeners();
  }

  setupListeners() {
    // ë‹¤ë¥¸ íƒ­ì˜ ì¸ì¦ ì´ë²¤íŠ¸ ìˆ˜ì‹ 
    this.channel.addEventListener('message', (event) => {
      const { type, user } = event.data;

      switch (type) {
        case 'LOGIN':
          this.handleRemoteLogin(user);
          break;
        case 'LOGOUT':
          this.handleRemoteLogout();
          break;
        case 'TOKEN_REFRESH':
          this.handleTokenRefresh(event.data.token);
          break;
      }
    });
  }

  // í˜„ì¬ íƒ­ì—ì„œ ë¡œê·¸ì¸
  login(user) {
    // 1. ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
    localStorage.setItem('user', JSON.stringify(user));

    // 2. ë‹¤ë¥¸ íƒ­ì— ì•Œë¦¼
    this.channel.postMessage({
      type: 'LOGIN',
      user: user,
      timestamp: Date.now()
    });

    // 3. UI ì—…ë°ì´íŠ¸
    this.updateUI(user);
  }

  // ë‹¤ë¥¸ íƒ­ì˜ ë¡œê·¸ì¸ ì²˜ë¦¬
  handleRemoteLogin(user) {
    console.log('ë‹¤ë¥¸ íƒ­ì—ì„œ ë¡œê·¸ì¸ë¨:', user);

    // localStorageëŠ” ì´ë¯¸ ë‹¤ë¥¸ íƒ­ì—ì„œ ì—…ë°ì´íŠ¸ë¨
    // UIë§Œ ì—…ë°ì´íŠ¸
    this.updateUI(user);
  }

  // í˜„ì¬ íƒ­ì—ì„œ ë¡œê·¸ì•„ì›ƒ
  logout() {
    // 1. ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚­ì œ
    localStorage.removeItem('user');

    // 2. ë‹¤ë¥¸ íƒ­ì— ì•Œë¦¼
    this.channel.postMessage({
      type: 'LOGOUT',
      timestamp: Date.now()
    });

    // 3. UI ì—…ë°ì´íŠ¸
    this.updateUI(null);
  }

  // ë‹¤ë¥¸ íƒ­ì˜ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
  handleRemoteLogout() {
    console.log('ë‹¤ë¥¸ íƒ­ì—ì„œ ë¡œê·¸ì•„ì›ƒë¨');
    this.updateUI(null);

    // í•„ìš”ì‹œ í˜„ì¬ í˜ì´ì§€ ë¦¬ë””ë ‰ì…˜
    if (window.location.pathname !== '/login') {
      window.location.href = '/login';
    }
  }

  updateUI(user) {
    if (user) {
      document.getElementById('user-name').textContent = user.name;
      document.getElementById('login-btn').style.display = 'none';
      document.getElementById('logout-btn').style.display = 'block';
    } else {
      document.getElementById('login-btn').style.display = 'block';
      document.getElementById('logout-btn').style.display = 'none';
    }
  }

  // í† í° ê°±ì‹  ë™ê¸°í™”
  handleTokenRefresh(newToken) {
    localStorage.setItem('authToken', newToken);
    console.log('í† í°ì´ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤');
  }

  // ì •ë¦¬
  destroy() {
    this.channel.close();
  }
}

// ì‚¬ìš©
const authSync = new AuthSync();

// ë¡œê·¸ì¸ ë²„íŠ¼
document.getElementById('login-btn').addEventListener('click', async () => {
  const user = await loginAPI(username, password);
  authSync.login(user);
});

// ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
document.getElementById('logout-btn').addEventListener('click', () => {
  authSync.logout();
});

// í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
window.addEventListener('beforeunload', () => {
  authSync.destroy();
});
```

---

### ì˜ˆì œ 2: ì‹¤ì‹œê°„ ì¥ë°”êµ¬ë‹ˆ ë™ê¸°í™”

ì—¬ëŸ¬ íƒ­ì—ì„œ ì¥ë°”êµ¬ë‹ˆë¥¼ ì‹¤ì‹œê°„ ë™ê¸°í™”í•©ë‹ˆë‹¤.

```javascript
// cart-sync.js

class CartSync {
  constructor() {
    this.channel = new BroadcastChannel('cart-sync');
    this.cart = this.loadCart();
    this.setupListeners();
  }

  loadCart() {
    const saved = localStorage.getItem('cart');
    return saved ? JSON.parse(saved) : [];
  }

  saveCart() {
    localStorage.setItem('cart', JSON.stringify(this.cart));
  }

  setupListeners() {
    this.channel.addEventListener('message', (event) => {
      const { action, item, itemId } = event.data;

      switch (action) {
        case 'ADD_ITEM':
          this.handleRemoteAddItem(item);
          break;
        case 'REMOVE_ITEM':
          this.handleRemoteRemoveItem(itemId);
          break;
        case 'UPDATE_QUANTITY':
          this.handleRemoteUpdateQuantity(itemId, event.data.quantity);
          break;
        case 'CLEAR_CART':
          this.handleRemoteClearCart();
          break;
      }
    });
  }

  // í˜„ì¬ íƒ­ì—ì„œ ì•„ì´í…œ ì¶”ê°€
  addItem(item) {
    // 1. ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€
    const existingItem = this.cart.find(i => i.id === item.id);

    if (existingItem) {
      existingItem.quantity += item.quantity || 1;
    } else {
      this.cart.push({
        ...item,
        quantity: item.quantity || 1,
        addedAt: Date.now()
      });
    }

    // 2. ì €ì¥
    this.saveCart();

    // 3. ë‹¤ë¥¸ íƒ­ì— ì•Œë¦¼
    this.channel.postMessage({
      action: 'ADD_ITEM',
      item: item,
      timestamp: Date.now()
    });

    // 4. UI ì—…ë°ì´íŠ¸
    this.renderCart();
    this.showNotification(`${item.name}ì´(ê°€) ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤`);
  }

  // ë‹¤ë¥¸ íƒ­ì—ì„œ ì•„ì´í…œ ì¶”ê°€ë¨
  handleRemoteAddItem(item) {
    // cartëŠ” ì´ë¯¸ localStorageë¥¼ í†µí•´ ë™ê¸°í™”ë¨
    // ë¡œì»¬ ìƒíƒœë§Œ ì—…ë°ì´íŠ¸
    this.cart = this.loadCart();
    this.renderCart();
    this.showNotification(`ë‹¤ë¥¸ íƒ­ì—ì„œ ${item.name}ì´(ê°€) ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤`);
  }

  // ì•„ì´í…œ ì œê±°
  removeItem(itemId) {
    this.cart = this.cart.filter(item => item.id !== itemId);
    this.saveCart();

    this.channel.postMessage({
      action: 'REMOVE_ITEM',
      itemId: itemId,
      timestamp: Date.now()
    });

    this.renderCart();
  }

  handleRemoteRemoveItem(itemId) {
    this.cart = this.loadCart();
    this.renderCart();
    this.showNotification('ì•„ì´í…œì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤');
  }

  // ìˆ˜ëŸ‰ ë³€ê²½
  updateQuantity(itemId, quantity) {
    const item = this.cart.find(i => i.id === itemId);
    if (item) {
      item.quantity = quantity;
      this.saveCart();

      this.channel.postMessage({
        action: 'UPDATE_QUANTITY',
        itemId: itemId,
        quantity: quantity,
        timestamp: Date.now()
      });

      this.renderCart();
    }
  }

  handleRemoteUpdateQuantity(itemId, quantity) {
    this.cart = this.loadCart();
    this.renderCart();
  }

  // ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°
  clearCart() {
    this.cart = [];
    this.saveCart();

    this.channel.postMessage({
      action: 'CLEAR_CART',
      timestamp: Date.now()
    });

    this.renderCart();
  }

  handleRemoteClearCart() {
    this.cart = [];
    this.renderCart();
    this.showNotification('ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì›Œì¡ŒìŠµë‹ˆë‹¤');
  }

  // UI ë Œë”ë§
  renderCart() {
    const cartElement = document.getElementById('cart-items');
    const totalElement = document.getElementById('cart-total');

    if (this.cart.length === 0) {
      cartElement.innerHTML = '<p>ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤</p>';
      totalElement.textContent = 'â‚©0';
      return;
    }

    const html = this.cart.map(item => `
      <div class="cart-item" data-id="${item.id}">
        <img src="${item.image}" alt="${item.name}">
        <div class="item-info">
          <h3>${item.name}</h3>
          <p>â‚©${item.price.toLocaleString()}</p>
          <input
            type="number"
            value="${item.quantity}"
            min="1"
            onchange="cartSync.updateQuantity('${item.id}', parseInt(this.value))"
          >
        </div>
        <button onclick="cartSync.removeItem('${item.id}')">ì‚­ì œ</button>
      </div>
    `).join('');

    cartElement.innerHTML = html;

    const total = this.cart.reduce(
      (sum, item) => sum + (item.price * item.quantity),
      0
    );
    totalElement.textContent = `â‚©${total.toLocaleString()}`;
  }

  showNotification(message) {
    // ê°„ë‹¨í•œ í† ìŠ¤íŠ¸ ì•Œë¦¼
    const toast = document.createElement('div');
    toast.className = 'toast-notification';
    toast.textContent = message;
    document.body.appendChild(toast);

    setTimeout(() => toast.remove(), 3000);
  }

  destroy() {
    this.channel.close();
  }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤
const cartSync = new CartSync();
```

---

### ì˜ˆì œ 3: í…Œë§ˆ ì„¤ì • ë™ê¸°í™”

ë‹¤í¬ëª¨ë“œ/ë¼ì´íŠ¸ëª¨ë“œë¥¼ ëª¨ë“  íƒ­ì—ì„œ ë™ê¸°í™”í•©ë‹ˆë‹¤.

```javascript
// theme-sync.js

class ThemeSync {
  constructor() {
    this.channel = new BroadcastChannel('theme-sync');
    this.currentTheme = this.loadTheme();
    this.applyTheme(this.currentTheme);
    this.setupListeners();
  }

  loadTheme() {
    return localStorage.getItem('theme') || 'light';
  }

  setupListeners() {
    this.channel.addEventListener('message', (event) => {
      if (event.data.type === 'THEME_CHANGE') {
        this.applyTheme(event.data.theme);
      }
    });
  }

  setTheme(theme) {
    // 1. ì €ì¥
    localStorage.setItem('theme', theme);
    this.currentTheme = theme;

    // 2. ë‹¤ë¥¸ íƒ­ì— ì•Œë¦¼
    this.channel.postMessage({
      type: 'THEME_CHANGE',
      theme: theme,
      timestamp: Date.now()
    });

    // 3. í˜„ì¬ íƒ­ì— ì ìš©
    this.applyTheme(theme);
  }

  applyTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);

    // í…Œë§ˆ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
    const themeIcon = document.getElementById('theme-icon');
    if (themeIcon) {
      themeIcon.textContent = theme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
    }

    console.log(`í…Œë§ˆê°€ ${theme}(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤`);
  }

  toggleTheme() {
    const newTheme = this.currentTheme === 'light' ? 'dark' : 'light';
    this.setTheme(newTheme);
  }

  destroy() {
    this.channel.close();
  }
}

// ì‚¬ìš©
const themeSync = new ThemeSync();

document.getElementById('theme-toggle').addEventListener('click', () => {
  themeSync.toggleTheme();
});
```

---

### ì˜ˆì œ 4: ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ

ëª¨ë“  íƒ­ì— ì•Œë¦¼ì„ ë¸Œë¡œë“œìºìŠ¤íŠ¸í•©ë‹ˆë‹¤.

```javascript
// notification-manager.js

class NotificationManager {
  constructor() {
    this.channel = new BroadcastChannel('notifications');
    this.notifications = [];
    this.setupListeners();
  }

  setupListeners() {
    this.channel.addEventListener('message', (event) => {
      if (event.data.type === 'NEW_NOTIFICATION') {
        this.showNotification(event.data.notification);
      } else if (event.data.type === 'MARK_AS_READ') {
        this.markAsRead(event.data.notificationId);
      }
    });
  }

  // ìƒˆ ì•Œë¦¼ ìƒì„± ë° ë¸Œë¡œë“œìºìŠ¤íŠ¸
  createNotification(notification) {
    const newNotification = {
      id: Date.now() + Math.random(),
      ...notification,
      read: false,
      createdAt: Date.now()
    };

    // ë‹¤ë¥¸ íƒ­ì— ë¸Œë¡œë“œìºìŠ¤íŠ¸
    this.channel.postMessage({
      type: 'NEW_NOTIFICATION',
      notification: newNotification
    });

    // í˜„ì¬ íƒ­ì—ë„ í‘œì‹œ
    this.showNotification(newNotification);

    return newNotification;
  }

  showNotification(notification) {
    this.notifications.unshift(notification);

    // UIì— í‘œì‹œ
    const container = document.getElementById('notification-container');
    const notifEl = document.createElement('div');
    notifEl.className = `notification ${notification.type}`;
    notifEl.innerHTML = `
      <div class="notification-content">
        <h4>${notification.title}</h4>
        <p>${notification.message}</p>
        <small>${new Date(notification.createdAt).toLocaleTimeString()}</small>
      </div>
      <button onclick="notificationManager.markAsRead('${notification.id}')">
        âœ“
      </button>
    `;

    container.prepend(notifEl);

    // ë¸Œë¼ìš°ì € ì•Œë¦¼ (ê¶Œí•œì´ ìˆëŠ” ê²½ìš°)
    if (Notification.permission === 'granted') {
      new Notification(notification.title, {
        body: notification.message,
        icon: '/icon.png'
      });
    }
  }

  markAsRead(notificationId) {
    // ë‹¤ë¥¸ íƒ­ì— ì•Œë¦¼
    this.channel.postMessage({
      type: 'MARK_AS_READ',
      notificationId: notificationId
    });

    // UI ì—…ë°ì´íŠ¸
    const notif = this.notifications.find(n => n.id === notificationId);
    if (notif) {
      notif.read = true;
      this.updateNotificationUI(notificationId);
    }
  }

  updateNotificationUI(notificationId) {
    const notifEl = document.querySelector(
      `[data-notification-id="${notificationId}"]`
    );
    if (notifEl) {
      notifEl.classList.add('read');
    }
  }

  destroy() {
    this.channel.close();
  }
}

// ì‚¬ìš©
const notificationManager = new NotificationManager();

// ì˜ˆì‹œ: ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼
document.getElementById('send-message').addEventListener('click', () => {
  notificationManager.createNotification({
    type: 'success',
    title: 'ìƒˆ ë©”ì‹œì§€',
    message: 'ìƒˆë¡œìš´ ë©”ì‹œì§€ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤'
  });
});
```

---

## ì¥ì ê³¼ í•œê³„

### ì¥ì 

- âœ… **ê°„ë‹¨í•œ API**: ëª‡ ì¤„ì˜ ì½”ë“œë§Œìœ¼ë¡œ ë©€í‹°íƒ­ í†µì‹  êµ¬í˜„
- âœ… **êµ¬ì¡°í™”ëœ ë°ì´í„° ì§€ì›**: ê°ì²´ì™€ ë°°ì—´ì„ ì§ë ¬í™” ì—†ì´ ì „ì†¡ ê°€ëŠ¥
- âœ… **ì–‘ë°©í–¥ í†µì‹ **: ëª¨ë“  ì±„ë„ì´ ì†¡ìˆ˜ì‹  ê°€ëŠ¥
- âœ… **ë‚®ì€ ì˜¤ë²„í—¤ë“œ**: localStorage pollingë³´ë‹¤ íš¨ìœ¨ì 
- âœ… **íƒ€ì… ì•ˆì „ì„±**: TypeScriptì™€ ì™„ë²½ í˜¸í™˜

### í•œê³„

- âš ï¸ **Same-Origin ì œí•œ**: ë‹¤ë¥¸ ë„ë©”ì¸ ê°„ í†µì‹  ë¶ˆê°€
  ```javascript
  // âŒ ë¶ˆê°€ëŠ¥
  // https://example.com íƒ­ê³¼ https://other-domain.com íƒ­ ê°„ í†µì‹ 
  ```

- âš ï¸ **ì˜êµ¬ì„± ì—†ìŒ**: ì±„ë„ì€ ë©”ëª¨ë¦¬ì—ë§Œ ì¡´ì¬, ì¬ì‹œì‘í•˜ë©´ ì†Œì‹¤
  ```javascript
  // ì˜êµ¬ ì €ì¥ì´ í•„ìš”í•˜ë©´ localStorageì™€ ë³‘ìš©
  channel.postMessage(data);
  localStorage.setItem('backup', JSON.stringify(data));
  ```

- âš ï¸ **ìˆœì„œ ë³´ì¥ ì œí•œ**: ë©”ì‹œì§€ ìˆœì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ ìœ ì§€ë˜ì§€ë§Œ ë³´ì¥ë˜ì§€ ì•ŠìŒ

- âš ï¸ **ì „ì†¡ í¬ê¸° ì œí•œ**: ë§¤ìš° í° ë°ì´í„°ëŠ” ì„±ëŠ¥ ë¬¸ì œ ë°œìƒ ê°€ëŠ¥
  ```javascript
  // âŒ í”¼í•´ì•¼ í•  ê²ƒ
  channel.postMessage(veryLargeArray); // 10MB+ ë°ì´í„°

  // âœ… ê¶Œì¥
  // í•„ìš”í•œ ë°ì´í„°ë§Œ ì „ì†¡í•˜ê±°ë‚˜ IndexedDB ì‚¬ìš©
  ```

### ì–¸ì œ ì‚¬ìš©í•˜ê³ , ì–¸ì œ í”¼í•´ì•¼ í•˜ëŠ”ê°€?

**ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ê²½ìš°:**
- ì‚¬ìš©ì ì¸ì¦ ìƒíƒœ ë™ê¸°í™”
- í…Œë§ˆ/ì„¤ì • ë™ê¸°í™”
- ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ
- ì¥ë°”êµ¬ë‹ˆ/ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ë™ê¸°í™”
- ë©€í‹°íƒ­ ê²Œì„ ìƒíƒœ ê³µìœ 

**í”¼í•´ì•¼ í•˜ëŠ” ê²½ìš°:**
- í¬ë¡œìŠ¤ ë„ë©”ì¸ í†µì‹  í•„ìš” ì‹œ â†’ `postMessage()` ì‚¬ìš©
- ì˜êµ¬ ì €ì¥ í•„ìš” ì‹œ â†’ IndexedDB ì‚¬ìš©
- ëŒ€ìš©ëŸ‰ ë°ì´í„° ì „ì†¡ â†’ ì„œë²„ ê²½ìœ  ë˜ëŠ” SharedWorker
- ì—„ê²©í•œ ìˆœì„œ ë³´ì¥ í•„ìš” ì‹œ â†’ ë³„ë„ ìˆœì„œ ë²ˆí˜¸ ì²´ê³„ êµ¬í˜„

---

## ë¸Œë¼ìš°ì € ì§€ì›

### ì§€ì› í˜„í™©

```javascript
// ë¸Œë¼ìš°ì € ì§€ì› í™•ì¸
if ('BroadcastChannel' in window) {
  const channel = new BroadcastChannel('my-channel');
  // BroadcastChannel ì‚¬ìš©
} else {
  console.warn('BroadcastChannelì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
  // í´ë°± êµ¬í˜„ (localStorage + storage ì´ë²¤íŠ¸)
}
```

**ì§€ì› ë¸Œë¼ìš°ì €:**
- âœ… Chrome 54+
- âœ… Firefox 38+
- âœ… Safari 15.4+
- âœ… Edge 79+
- âŒ Internet Explorer (ë¯¸ì§€ì›)

### í´ë°± êµ¬í˜„

```javascript
// polyfill-broadcast-channel.js

class BroadcastChannelPolyfill {
  constructor(channelName) {
    this.name = channelName;
    this.onmessage = null;
    this._setupStorageListener();
  }

  _setupStorageListener() {
    window.addEventListener('storage', (e) => {
      if (e.key === `broadcast_${this.name}`) {
        try {
          const data = JSON.parse(e.newValue);
          if (this.onmessage) {
            this.onmessage({ data });
          }
        } catch (err) {
          console.error('ë©”ì‹œì§€ íŒŒì‹± ì˜¤ë¥˜:', err);
        }
      }
    });
  }

  postMessage(message) {
    const key = `broadcast_${this.name}`;
    // localStorageë¥¼ ì‚¬ìš©í•œ í´ë°±
    localStorage.setItem(key, JSON.stringify(message));
    // ì¦‰ì‹œ ì œê±° (storage ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°ìš©)
    localStorage.removeItem(key);
  }

  close() {
    // ì •ë¦¬ ì‘ì—…
  }
}

// ìë™ í´ë°±
window.BroadcastChannel = window.BroadcastChannel || BroadcastChannelPolyfill;
```

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: ë©”ì‹œì§€ê°€ ì „ë‹¬ë˜ì§€ ì•ŠìŒ

**ì¦ìƒ:**
```javascript
const channel = new BroadcastChannel('test');
channel.postMessage('Hello'); // ë‹¤ë¥¸ íƒ­ì—ì„œ ë°›ì§€ ëª»í•¨
```

**ì›ì¸:**
1. ì±„ë„ ì´ë¦„ì´ ë‹¤ë¦„
2. Originì´ ë‹¤ë¦„ (í”„ë¡œí† ì½œ, ë„ë©”ì¸, í¬íŠ¸)
3. ë¦¬ìŠ¤ë„ˆê°€ ì„¤ì •ë˜ê¸° ì „ì— ë©”ì‹œì§€ ì „ì†¡

**í•´ê²° ë°©ë²•:**

```javascript
// âœ… ë°©ë²• 1: ì±„ë„ ì´ë¦„ í™•ì¸
// Tab 1
const channel1 = new BroadcastChannel('my-channel'); // âœ“

// Tab 2
const channel2 = new BroadcastChannel('my-channel'); // âœ“ ë™ì¼í•´ì•¼ í•¨

// âœ… ë°©ë²• 2: Origin í™•ì¸
// http://localhost:3000 âœ“
// http://localhost:3001 âŒ ë‹¤ë¥¸ í¬íŠ¸
// https://localhost:3000 âŒ ë‹¤ë¥¸ í”„ë¡œí† ì½œ

// âœ… ë°©ë²• 3: ë¦¬ìŠ¤ë„ˆ ë¨¼ì € ì„¤ì •
const channel = new BroadcastChannel('test');

// ë¦¬ìŠ¤ë„ˆ ë¨¼ì € ì„¤ì •
channel.addEventListener('message', (e) => {
  console.log('ë°›ìŒ:', e.data);
});

// ê·¸ ë‹¤ìŒ ë©”ì‹œì§€ ì „ì†¡
setTimeout(() => {
  channel.postMessage('Hello');
}, 100);
```

---

### ë¬¸ì œ 2: ê°™ì€ íƒ­ì—ì„œ ë©”ì‹œì§€ë¥¼ ë°›ìŒ

**ì¦ìƒ:**
```javascript
const channel = new BroadcastChannel('test');
channel.onmessage = (e) => {
  console.log('ë°›ìŒ:', e.data); // ìì‹ ì´ ë³´ë‚¸ ë©”ì‹œì§€ë„ ë°›ìŒ?
};
channel.postMessage('Hello');
```

**ì„¤ëª…:**
BroadcastChannelì€ **ì†¡ì‹ ìë¥¼ ì œì™¸í•œ** ê°™ì€ ì±„ë„ì˜ ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ì—ê²Œë§Œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤. ìì‹ ì´ ë³´ë‚¸ ë©”ì‹œì§€ëŠ” ë°›ì§€ ì•ŠìŠµë‹ˆë‹¤.

**ê²€ì¦:**
```javascript
const channel = new BroadcastChannel('test');

let receivedCount = 0;

channel.onmessage = (e) => {
  receivedCount++;
  console.log(`ë°›ì€ íšŸìˆ˜: ${receivedCount}`, e.data);
};

// 10ê°œ ì „ì†¡
for (let i = 0; i < 10; i++) {
  channel.postMessage(`Message ${i}`);
}

// receivedCountëŠ” 0ì´ì–´ì•¼ í•¨ (ë‹¤ë¥¸ íƒ­ì´ ì—†ìœ¼ë©´)
setTimeout(() => {
  console.log('ìµœì¢… ë°›ì€ íšŸìˆ˜:', receivedCount); // 0
}, 1000);
```

---

### ë¬¸ì œ 3: ë©”ëª¨ë¦¬ ëˆ„ìˆ˜

**ì¦ìƒ:**
```javascript
// ì»´í¬ë„ŒíŠ¸ê°€ ì–¸ë§ˆìš´íŠ¸ë˜ì–´ë„ ì±„ë„ì´ ë‚¨ì•„ìˆìŒ
function MyComponent() {
  const channel = new BroadcastChannel('test');

  channel.onmessage = (e) => {
    console.log(e.data);
  };

  // âŒ ì •ë¦¬í•˜ì§€ ì•ŠìŒ
}
```

**í•´ê²° ë°©ë²•:**

```javascript
// âœ… React ì˜ˆì‹œ
import { useEffect, useRef } from 'react';

function MyComponent() {
  const channelRef = useRef(null);

  useEffect(() => {
    // ì±„ë„ ìƒì„±
    channelRef.current = new BroadcastChannel('test');

    const handleMessage = (event) => {
      console.log('ë°›ìŒ:', event.data);
    };

    channelRef.current.addEventListener('message', handleMessage);

    // ì •ë¦¬ í•¨ìˆ˜
    return () => {
      channelRef.current.removeEventListener('message', handleMessage);
      channelRef.current.close();
      channelRef.current = null;
    };
  }, []);

  const sendMessage = (data) => {
    channelRef.current?.postMessage(data);
  };

  return (
    <button onClick={() => sendMessage('Hello')}>
      ë©”ì‹œì§€ ì „ì†¡
    </button>
  );
}

// âœ… Vanilla JS ì˜ˆì‹œ
class ChatComponent {
  constructor() {
    this.channel = new BroadcastChannel('chat');
    this.channel.onmessage = this.handleMessage.bind(this);
  }

  handleMessage(event) {
    console.log(event.data);
  }

  destroy() {
    this.channel.close();
    this.channel = null;
  }
}

const chat = new ChatComponent();

// í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ
window.addEventListener('beforeunload', () => {
  chat.destroy();
});
```

---

### ë¬¸ì œ 4: ë©”ì‹œì§€ ìˆœì„œ ë³´ì¥

**ë¬¸ì œ:**
```javascript
const channel = new BroadcastChannel('test');

// ìˆœì„œëŒ€ë¡œ ì „ì†¡
channel.postMessage({ order: 1 });
channel.postMessage({ order: 2 });
channel.postMessage({ order: 3 });

// ë‹¤ë¥¸ íƒ­ì—ì„œ ìˆœì„œê°€ ë’¤ë°”ë€” ìˆ˜ ìˆìŒ?
```

**í•´ê²° ë°©ë²•:**

```javascript
// âœ… íƒ€ì„ìŠ¤íƒ¬í”„ ë˜ëŠ” ì‹œí€€ìŠ¤ ë²ˆí˜¸ ì¶”ê°€
class OrderedBroadcastChannel {
  constructor(channelName) {
    this.channel = new BroadcastChannel(channelName);
    this.sequence = 0;
    this.receivedMessages = new Map();
    this.expectedSequence = 0;

    this.channel.addEventListener('message', (event) => {
      this.handleOrderedMessage(event.data);
    });
  }

  postMessage(data) {
    this.channel.postMessage({
      sequence: this.sequence++,
      timestamp: Date.now(),
      data: data
    });
  }

  handleOrderedMessage(message) {
    const { sequence, data } = message;

    // ë²„í¼ì— ì €ì¥
    this.receivedMessages.set(sequence, data);

    // ìˆœì„œëŒ€ë¡œ ì²˜ë¦¬
    while (this.receivedMessages.has(this.expectedSequence)) {
      const orderedData = this.receivedMessages.get(this.expectedSequence);
      this.onmessage?.(orderedData);
      this.receivedMessages.delete(this.expectedSequence);
      this.expectedSequence++;
    }
  }

  onmessage = null;

  close() {
    this.channel.close();
  }
}

// ì‚¬ìš©
const orderedChannel = new OrderedBroadcastChannel('ordered-test');
orderedChannel.onmessage = (data) => {
  console.log('ìˆœì„œëŒ€ë¡œ ë°›ìŒ:', data);
};
```

---

## ì„±ëŠ¥ ìµœì í™”

### ìµœì í™” 1: ë©”ì‹œì§€ ë°°ì¹˜ ì²˜ë¦¬

ë¹ˆë²ˆí•œ ì—…ë°ì´íŠ¸ë¥¼ ë°°ì¹˜ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

```javascript
class BatchedBroadcastChannel {
  constructor(channelName, batchInterval = 100) {
    this.channel = new BroadcastChannel(channelName);
    this.pendingMessages = [];
    this.batchInterval = batchInterval;
    this.batchTimer = null;
  }

  postMessage(message) {
    this.pendingMessages.push(message);

    if (!this.batchTimer) {
      this.batchTimer = setTimeout(() => {
        this.flush();
      }, this.batchInterval);
    }
  }

  flush() {
    if (this.pendingMessages.length > 0) {
      this.channel.postMessage({
        type: 'BATCH',
        messages: this.pendingMessages,
        count: this.pendingMessages.length
      });

      this.pendingMessages = [];
    }
    this.batchTimer = null;
  }

  close() {
    this.flush(); // ë‚¨ì€ ë©”ì‹œì§€ ì „ì†¡
    this.channel.close();
  }
}

// ì‚¬ìš©
const batchChannel = new BatchedBroadcastChannel('batch-test', 100);

// 100ms ë‚´ì˜ ëª¨ë“  ë©”ì‹œì§€ê°€ í•˜ë‚˜ì˜ ë°°ì¹˜ë¡œ ì „ì†¡ë¨
for (let i = 0; i < 50; i++) {
  batchChannel.postMessage({ id: i, data: 'test' });
}
```

---

### ìµœì í™” 2: ë©”ì‹œì§€ ì••ì¶•

í° ë°ì´í„°ë¥¼ ì••ì¶•í•˜ì—¬ ì „ì†¡í•©ë‹ˆë‹¤.

```javascript
class CompressedBroadcastChannel {
  constructor(channelName) {
    this.channel = new BroadcastChannel(channelName);
    this.channel.addEventListener('message', async (event) => {
      const decompressed = await this.decompress(event.data);
      this.onmessage?.(decompressed);
    });
  }

  async postMessage(data) {
    const compressed = await this.compress(data);
    this.channel.postMessage(compressed);
  }

  async compress(data) {
    const json = JSON.stringify(data);
    const blob = new Blob([json]);
    const stream = blob.stream();
    const compressedStream = stream.pipeThrough(
      new CompressionStream('gzip')
    );
    const compressedBlob = await new Response(compressedStream).blob();
    const buffer = await compressedBlob.arrayBuffer();
    return {
      compressed: true,
      data: Array.from(new Uint8Array(buffer))
    };
  }

  async decompress(message) {
    if (!message.compressed) return message;

    const uint8Array = new Uint8Array(message.data);
    const blob = new Blob([uint8Array]);
    const stream = blob.stream();
    const decompressedStream = stream.pipeThrough(
      new DecompressionStream('gzip')
    );
    const decompressedBlob = await new Response(decompressedStream).blob();
    const text = await decompressedBlob.text();
    return JSON.parse(text);
  }

  onmessage = null;

  close() {
    this.channel.close();
  }
}
```

---

## ê´€ë ¨ ê¸°ìˆ  ë¹„êµ

### vs localStorage + storage ì´ë²¤íŠ¸

| ê¸°ëŠ¥ | BroadcastChannel | localStorage + storage |
|------|------------------|------------------------|
| êµ¬ì¡°í™”ëœ ë°ì´í„° | âœ… ì§ì ‘ ì§€ì› | âŒ ë¬¸ìì—´ë§Œ, ì§ë ¬í™” í•„ìš” |
| ì„±ëŠ¥ | âœ… ë¹ ë¦„ | âš ï¸ ëŠë¦¼ (ë””ìŠ¤í¬ I/O) |
| ë©”ëª¨ë¦¬ íš¨ìœ¨ | âœ… ë†’ìŒ | âš ï¸ ë‚®ìŒ |
| ì˜êµ¬ ì €ì¥ | âŒ ì—†ìŒ | âœ… ìˆìŒ |
| ê°™ì€ íƒ­ ì´ë²¤íŠ¸ | âŒ ì—†ìŒ | âŒ ì—†ìŒ |

**ê¶Œì¥ ì‚¬ìš©:**
- BroadcastChannel: ì„ì‹œ ë™ê¸°í™”, ì‹¤ì‹œê°„ í†µì‹ 
- localStorage: ì˜êµ¬ ì €ì¥ + ë™ê¸°í™”

```javascript
// ë³‘ìš© ì˜ˆì‹œ
const channel = new BroadcastChannel('sync');

function updateData(data) {
  // 1. localStorageì— ì €ì¥ (ì˜êµ¬ ì €ì¥)
  localStorage.setItem('data', JSON.stringify(data));

  // 2. BroadcastChannelë¡œ ë‹¤ë¥¸ íƒ­ì— ì•Œë¦¼ (ì‹¤ì‹œê°„)
  channel.postMessage({
    type: 'DATA_UPDATE',
    data: data
  });
}
```

---

### vs SharedWorker

| ê¸°ëŠ¥ | BroadcastChannel | SharedWorker |
|------|------------------|--------------|
| API ë³µì¡ë„ | âœ… ê°„ë‹¨ | âŒ ë³µì¡ |
| ë¸Œë¼ìš°ì € ì§€ì› | âœ… ë„“ìŒ | âš ï¸ ì œí•œì  |
| ì¤‘ì•™ ì²˜ë¦¬ | âŒ ì—†ìŒ | âœ… ìˆìŒ |
| ì„œë²„ ì—°ê²° ê³µìœ  | âŒ ë¶ˆê°€ | âœ… ê°€ëŠ¥ |

**ì–¸ì œ ë¬´ì—‡ì„ ì‚¬ìš©:**
- BroadcastChannel: ë‹¨ìˆœ ë©”ì‹œì§€ ë¸Œë¡œë“œìºìŠ¤íŠ¸
- SharedWorker: WebSocket ê³µìœ , ì¤‘ì•™ ìƒíƒœ ê´€ë¦¬

---

### vs postMessage (Window)

| ê¸°ëŠ¥ | BroadcastChannel | window.postMessage |
|------|------------------|-------------------|
| í¬ë¡œìŠ¤ ë„ë©”ì¸ | âŒ ë¶ˆê°€ | âœ… ê°€ëŠ¥ |
| iframe í†µì‹  | âŒ ë¶ˆê°€ | âœ… ê°€ëŠ¥ |
| ìë™ ë¸Œë¡œë“œìºìŠ¤íŠ¸ | âœ… ìˆìŒ | âŒ ì—†ìŒ (1:1) |
| ì„¤ì • ë³µì¡ë„ | âœ… ê°„ë‹¨ | âš ï¸ ë³µì¡ |

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**
- BroadcastChannel: ê°™ì€ originì˜ ëª¨ë“  íƒ­/ì›Œì»¤ í†µì‹ 
- postMessage: iframe, íŒì—…, í¬ë¡œìŠ¤ ë„ë©”ì¸ í†µì‹ 

---

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. Same-Origin ì •ì±…

```javascript
// âœ… ì•ˆì „: ê°™ì€ originë§Œ í†µì‹  ê°€ëŠ¥
// https://example.com/page1 â†” https://example.com/page2

// âŒ ë¶ˆê°€ëŠ¥
// https://example.com â†” https://evil.com
```

### 2. ë¯¼ê°í•œ ë°ì´í„° ì£¼ì˜

```javascript
// âŒ í”¼í•´ì•¼ í•  ê²ƒ
channel.postMessage({
  creditCard: '1234-5678-9012-3456',
  password: 'secret123'
});

// âœ… ê¶Œì¥
channel.postMessage({
  action: 'PAYMENT_COMPLETED',
  transactionId: 'abc123' // IDë§Œ ì „ì†¡
});
```

### 3. ë©”ì‹œì§€ ê²€ì¦

```javascript
const channel = new BroadcastChannel('secure-channel');

channel.addEventListener('message', (event) => {
  // ë©”ì‹œì§€ êµ¬ì¡° ê²€ì¦
  if (!isValidMessage(event.data)) {
    console.warn('ìœ íš¨í•˜ì§€ ì•Šì€ ë©”ì‹œì§€:', event.data);
    return;
  }

  // ì²˜ë¦¬
  handleMessage(event.data);
});

function isValidMessage(data) {
  return (
    data &&
    typeof data === 'object' &&
    typeof data.type === 'string' &&
    data.timestamp &&
    Date.now() - data.timestamp < 60000 // 1ë¶„ ì´ë‚´
  );
}
```

---

## Reactì—ì„œ ì‚¬ìš©í•˜ê¸°

### Custom Hook êµ¬í˜„

```typescript
// useBroadcastChannel.ts

import { useEffect, useRef, useCallback } from 'react';

interface UseBroadcastChannelOptions<T> {
  channelName: string;
  onMessage?: (data: T) => void;
}

export function useBroadcastChannel<T = any>({
  channelName,
  onMessage
}: UseBroadcastChannelOptions<T>) {
  const channelRef = useRef<BroadcastChannel | null>(null);

  useEffect(() => {
    // ì±„ë„ ìƒì„±
    channelRef.current = new BroadcastChannel(channelName);

    // ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ
    const handleMessage = (event: MessageEvent<T>) => {
      onMessage?.(event.data);
    };

    channelRef.current.addEventListener('message', handleMessage);

    // ì •ë¦¬
    return () => {
      channelRef.current?.removeEventListener('message', handleMessage);
      channelRef.current?.close();
      channelRef.current = null;
    };
  }, [channelName, onMessage]);

  // ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜
  const postMessage = useCallback((data: T) => {
    channelRef.current?.postMessage(data);
  }, []);

  return { postMessage };
}
```

### ì‚¬ìš© ì˜ˆì‹œ

```typescript
// App.tsx

import { useState } from 'react';
import { useBroadcastChannel } from './useBroadcastChannel';

interface AuthMessage {
  type: 'LOGIN' | 'LOGOUT';
  user?: { id: string; name: string };
}

function App() {
  const [user, setUser] = useState<User | null>(null);

  const { postMessage } = useBroadcastChannel<AuthMessage>({
    channelName: 'auth',
    onMessage: (data) => {
      if (data.type === 'LOGIN' && data.user) {
        setUser(data.user);
      } else if (data.type === 'LOGOUT') {
        setUser(null);
      }
    }
  });

  const handleLogin = async () => {
    const user = await loginAPI();
    setUser(user);

    // ë‹¤ë¥¸ íƒ­ì— ì•Œë¦¼
    postMessage({
      type: 'LOGIN',
      user: user
    });
  };

  const handleLogout = () => {
    setUser(null);

    // ë‹¤ë¥¸ íƒ­ì— ì•Œë¦¼
    postMessage({
      type: 'LOGOUT'
    });
  };

  return (
    <div>
      {user ? (
        <>
          <p>í™˜ì˜í•©ë‹ˆë‹¤, {user.name}ë‹˜!</p>
          <button onClick={handleLogout}>ë¡œê·¸ì•„ì›ƒ</button>
        </>
      ) : (
        <button onClick={handleLogin}>ë¡œê·¸ì¸</button>
      )}
    </div>
  );
}
```

---

## ë‹¤ìŒ ë‹¨ê³„

### ì¶”ê°€ í•™ìŠµ ìë£Œ

- [MDN: BroadcastChannel API](https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API)
- [Web.dev: BroadcastChannel](https://web.dev/broadcastchannel/)
- [Can I Use: BroadcastChannel](https://caniuse.com/broadcastchannel)

### ì‹¤ìŠµ í”„ë¡œì íŠ¸

1. **ë©€í‹°íƒ­ ì±„íŒ… ì•±**: ì‹¤ì‹œê°„ ë©”ì‹œì§€ ë™ê¸°í™”
2. **í˜‘ì—… ì—ë””í„°**: ì—¬ëŸ¬ íƒ­ì—ì„œ ë¬¸ì„œ ê³µë™ í¸ì§‘
3. **ê²Œì„ ìƒíƒœ ë™ê¸°í™”**: ë©€í‹°íƒ­ ê²Œì„ êµ¬í˜„
4. **ì•Œë¦¼ ì„¼í„°**: ì „ì—­ ì•Œë¦¼ ì‹œìŠ¤í…œ

### ê´€ë ¨ API

- **SharedWorker**: íƒ­ ê°„ ê³µìœ  ì›Œì»¤
- **Service Worker**: ì˜¤í”„ë¼ì¸ ê¸°ëŠ¥, í‘¸ì‹œ ì•Œë¦¼
- **IndexedDB**: ëŒ€ìš©ëŸ‰ ë°ì´í„° ì €ì¥
- **WebSocket**: ì„œë²„ì™€ ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹ 

---

## ì°¸ê³  ìë£Œ

### ê³µì‹ ë¬¸ì„œ
- [WHATWG Spec](https://html.spec.whatwg.org/multipage/web-messaging.html#broadcasting-to-other-browsing-contexts)
- [MDN Web Docs](https://developer.mozilla.org/en-US/docs/Web/API/BroadcastChannel)

### ë¸Œë¼ìš°ì € ì§€ì›
- [Can I Use](https://caniuse.com/broadcastchannel)

### ë¼ì´ë¸ŒëŸ¬ë¦¬
- [broadcast-channel](https://github.com/pubkey/broadcast-channel) - í¬ë¡œìŠ¤ ë¸Œë¼ìš°ì € í´ë¦¬í•„

---

## ë§ˆë¬´ë¦¬

BroadcastChannel APIëŠ” ë©€í‹°íƒ­ í™˜ê²½ì—ì„œ ì›í™œí•œ ì‚¬ìš©ì ê²½í—˜ì„ ì œê³µí•˜ëŠ” ê°•ë ¥í•˜ê³  ê°„ë‹¨í•œ ë„êµ¬ì…ë‹ˆë‹¤. ë³µì¡í•œ ì„¤ì • ì—†ì´ ëª‡ ì¤„ì˜ ì½”ë“œë§Œìœ¼ë¡œ íƒ­ ê°„ ì‹¤ì‹œê°„ ë™ê¸°í™”ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•µì‹¬ì€ **ì ì¬ì ì†Œì— ì‚¬ìš©**í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤:
- ì‹¤ì‹œê°„ ë™ê¸°í™”ê°€ í•„ìš”í•œ ê²½ìš° â†’ BroadcastChannel
- ì˜êµ¬ ì €ì¥ì´ í•„ìš”í•œ ê²½ìš° â†’ localStorageì™€ ë³‘ìš©
- í¬ë¡œìŠ¤ ë„ë©”ì¸ í†µì‹  â†’ postMessage ì‚¬ìš©

ì´ì œ ì—¬ëŸ¬ë¶„ì˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì— BroadcastChannelì„ ì ìš©í•´ë³´ì„¸ìš”!

---

## ë¼ì´ì„ ìŠ¤

ì´ ë¬¸ì„œëŠ” [technical-writing.dev](https://technical-writing.dev) ê°€ì´ë“œë¼ì¸ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
